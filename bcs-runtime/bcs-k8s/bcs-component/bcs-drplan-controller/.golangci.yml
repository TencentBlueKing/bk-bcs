# golangci-lint v2 configuration for bcs-drplan-controller
version: "2"

run:
  # Use Go 1.24 for compatibility (golangci-lint binary built with Go 1.24)
  go: "1.24"
  timeout: 10m
  modules-download-mode: readonly

issues:
  max-issues-per-linter: 0
  max-same-issues: 0
  exclude-use-default: false
  exclude-dirs:
    - vendor
    - hack
    - config
    - .*/third_party/*
  exclude-files:
    - .*\.docs\.go$
    - .*\.gen\.go$
    - .*\.pb\.go$
    - .*\.pb.gw\.go$
    - .*\.pb.micro\.go$
    - .*\.pb.validate\.go$
    - .*zz_generated.*\.go$
  exclude-rules:
    # Test files can have higher complexity and skip error checks
    - path: _test\.go
      linters:
        - gocyclo
        - errcheck
        - funlen
        - gosec

linters:
  disable-all: true
  enable:
    - errcheck
    - govet
    - ineffassign
    - staticcheck
    - unused
    - funlen
    - goconst
    - gocritic
    - gocyclo
    - goheader
    - gosec
    - misspell
    - nakedret
    - revive
    - unconvert
    - unparam

formatters:
  enable:
    - gofmt
    - goimports

linters-settings:
  staticcheck:
    checks: ["all", "-SA1006", "-SA1019"]
  
  errcheck:
    exclude-functions:
      - (*os.File).Close
      - (io.Closer).Close
      - (net/http.ResponseWriter).Write
      - github.com/go-chi/render.Render
      - io.Copy
      - os.RemoveAll
      - fmt.Fprint
      - fmt.Fprintf
      - fmt.Fprintln
  
  # Note: lll linter not enabled to allow //nolint:lll for webhook annotations
  
  funlen:
    lines: 100
    statements: -1
  
  gocyclo:
    min-complexity: 20
  
  govet:
    enable:
      - shadow
    disable:
      - printf
  
  goimports:
    local-prefixes: github.com/Tencent/bk-bcs/bcs-runtime/bcs-k8s/bcs-component/bcs-drplan-controller
  
  gocritic:
    settings:
      ifElseChain:
        minThreshold: 3
  
  gosec:
    includes:
      - G201
      - G202
      - G101
      - G401
      - G402
      - G403
      - G404
      - G504
  
  goheader:
    values:
      regexp:
        YEAR: 20\d\d
    template: |-
      Tencent is pleased to support the open source community by making Blueking Container Service available.
      Copyright (C) {{ YEAR }} THL A29 Limited, a Tencent company. All rights reserved.
      Licensed under the MIT License (the "License"); you may not use this file except
      in compliance with the License. You may obtain a copy of the License at
      http://opensource.org/licenses/MIT
      Unless required by applicable law or agreed to in writing, software distributed under,
      the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
      either express or implied. See the License for the specific language governing permissions and
      limitations under the License.
  
  misspell:
    locale: US
  
  revive:
    confidence: 0
    rules:
      - name: blank-imports
      - name: context-as-argument
      - name: context-keys-type
      - name: dot-imports
      - name: early-return
      - name: error-naming
      - name: error-return
      - name: error-strings
      - name: errorf
      - name: exported
      - name: increment-decrement
      - name: indent-error-flow
      - name: package-comments
      - name: range
      - name: receiver-naming
      - name: time-naming
      - name: var-declaration
