<div class="biz-content">
    <Header hide-back :title="$t('deploy.templateset.appList')"></Header>
    <div class="biz-content-wrapper biz-app-loading" style="padding: 0;">
        <div class="biz-panel-header biz-app-query" style="padding: 27px 20px 15px 20px;">
            <div class="left" v-if="$INTERNAL">
                <bk-dropdown-menu :align="'center'" ref="toggleDropdown">
                    <a href="javascript:void(0);" slot="dropdown-trigger" class="dropdown-trigger-btn bk-text-button bg-[#fff]">
                        <template v-if="viewMode === 'template'">{{$t('deploy.templateset.clusterView')}}</template>
                        <template v-if="viewMode === 'namespace'">{{$t('deploy.templateset.nsView')}}</template>
                        <i class="bcs-icon bcs-icon-angle-down dropdown-menu-angle-down"></i>
                    </a>
                    <ul class="bk-dropdown-list" slot="dropdown-content">
                        <li>
                            <a href="javascript:void(0)" @click="toggleView('template')">{{$t('deploy.templateset.clusterView')}}</a>
                        </li>
                        <li>
                            <a href="javascript:void(0)" @click="toggleView('namespace')">{{$t('deploy.templateset.nsView')}}</a>
                        </li>
                    </ul>
                </bk-dropdown-menu>
            </div>
            <div class="left">
                <div class="cluster-search-warpper flex">
                    <span class="label" :class="clusterSearchSelectExpand ? 'is-focus' : ''">{{$t('deploy.templateset.clusterName')}}</span>
                    <ClusterSelect 
                        :disabled="bkSearcherMask"
                        :cluster-type="CATEGORY === 'daemonset' ? ['independent', 'managed', 'virtual'] : 'all'"
                        v-model="clusterValue"
                        @change="changeCluster">
                    </ClusterSelect>
                </div>
            </div>
            <div class="right">
                <div class="biz-search-input">
                    <bk-searcher
                        ref="bkSearcher"
                        :input-search-key="''"
                        :filter-list="bkSearcherFilterList"
                        :fixed-search-params="bkSearcherFixedSearchParams"
                        :mask="bkSearcherMask"
                        :minInputWidth="300"
                        :placeholder="$t('deploy.templateset.nsSearch')"
                        @getFilterListData="bkSearcherGetFilterListData"
                        @search="bkSearch">
                    </bk-searcher>
                    <a v-if="showClearSearch" href="javascript:void(0)" class="biz-search-btn" @click="search = ''">
                        <i class="bcs-icon bcs-icon-close-circle-shape" style="color: #dde4eb;"></i>
                    </a>
                </div>
                <span class="refresh-wrapper">
                    <bcs-popover class="refresh" :content="$t('generic.log.button.refresh')" :delay="500" placement="top">
                        <bk-button :class="['bk-button bk-default is-outline is-icon', {'is-disabled': showLoading}]" @click="refresh">
                            <i class="bcs-icon bcs-icon-refresh"></i>
                        </bk-button>
                    </bcs-popover>
                </span>
            </div>
        </div>

        <div v-bkloading="{isLoading: showLoading, color: '#f5f7fa'}" :class="tmplMusterList.length || namespaceList.length ? '' : 'biz-app-list-wrapper min-h-[200px]'">
            <!-------------------------------- 模板集视图 -------------------------------->
            <template v-if="viewMode === 'template'">
                <p class="biz-tip ml20 mb20">
                    <i class="bcs-icon bcs-icon-alarm-insufficient vm"></i>
                    <span class="vm">{{$t('deploy.templateset.appDetail')}}</span>
                </p>
                <div class="biz-app-list" v-if="tmplMusterList.length">
                    <div class="list-item-tplset" :class="tmplMuster.isOpen ? 'expand' : ''" v-for="(tmplMuster, tmplMusterIndex) in tmplMusterList">
                        <div class="list-item-tplset-inner"
                            v-authority="{
                                clickable: templateWebAnnotations.perms[tmplMuster.tmpl_muster_id]
                                    && templateWebAnnotations.perms[tmplMuster.tmpl_muster_id].templateset_instantiate,
                                actionId: 'templateset_instantiate',
                                resourceName: tmplMuster.tmpl_muster_name,
                                disablePerms: true,
                                permCtx: {
                                    project_id: projectId,
                                    template_id: tmplMuster.tmpl_muster_id
                                }
                            }"
                            @click="toggleTmplMuster(tmplMuster, tmplMusterIndex)"
                        >
                            <div class="app-name" :title="tmplMuster.tmpl_muster_name">
                                {{tmplMuster.tmpl_muster_name}}
                            </div>
                            <div class="app-desc">
                                {{$t('deploy.templateset.tplCounts', { total: tmplMuster.tmpl_num })}}
                            </div>
                            <div class="app-toggle">
                                <i class="bcs-icon" :class="tmplMuster.isOpen ? 'bcs-icon-angle-up' : 'bcs-icon-angle-down'"></i>
                            </div>
                        </div>

                        <!-- list-item-tpl -->
                        <template v-if="tmplMuster.isOpen">
                            <div class="list-item-tpl-wrapper" :style="{height: tmplMuster.templateLoading ? '70px': 'auto'}" v-bkloading="{isLoading: tmplMuster.templateLoading}">
                                <template v-if="tmplMuster.templateList && tmplMuster.templateList.length">
                                    <div class="list-item-tpl" v-for="(tpl, index) in tmplMuster.templateList">
                                        <div class="list-item-tpl-inner">
                                            <span @click.stop="toggleTemplate(tmplMuster, tmplMusterIndex, tpl, index)" style="cursor: pointer;">
                                                <i class="bcs-icon toggle" :class="tpl.isOpen ? 'bcs-icon-minus' : 'bcs-icon-plus'"></i>
                                                <span class="name">{{tpl.tmpl_app_name}}</span>
                                                <span class="ver">{{tpl.version}}</span>
                                                <span class="ver">{{tpl.category}}</span>
                                                <span class="status" v-if="tpl.total_num === 0">
                                                    {{$t('deploy.templateset.noApp')}}
                                                </span>
                                                <span class="status" v-else-if="tpl.error_num !== 0">
                                                    {{$t('deploy.templateset.errorApp', { total: tpl.error_num || 0 })}}
                                                </span>
                                                <span class="status normal" v-else>
                                                    {{$t('generic.status.ready')}}
                                                </span>
                                            </span>
                                            <span class="act">
                                                <template v-if="tpl.instanceList && tpl.instanceList.length && tpl.instanceList.filter(item => item.isChecked === true).length > 0">
                                                    <a href="javascript:void(0);" class="bk-text-button" @click="showBatchReBuild(tpl, index)">
                                                        {{$t('deploy.templateset.multiRecreate')}}
                                                    </a>
                                                    <a href="javascript:void(0);" class="bk-text-button" @click="batchDelete(tpl, index)">
                                                        {{$t('generic.button.batchDelete')}}
                                                    </a>
                                                </template>
                                                <template v-else>
                                                    <a href="javascript:void(0);" class="bk-text-button is-disabled">{{$t('deploy.templateset.multiRecreate')}}</a>
                                                    <a href="javascript:void(0);" class="bk-text-button is-disabled">{{$t('generic.button.batchDelete')}}</a>
                                                </template>
                                                <a href="javascript:void(0);" class="bk-text-button" @click="goInstantiation(tmplMuster, tpl)">{{$t('deploy.templateset.tempalte')}}</a>
                                            </span>
                                        </div>

                                        <template v-if="tpl.isOpen">
                                            <div class="list-item-tpl-table loading" v-if="instanceLoading" v-bkloading="{ isLoading: true }">
                                            </div>
                                            <div class="list-item-tpl-table" v-else v-bkloading="{ isLoading: false }">
                                                <table class="bk-table has-table-hover biz-table">
                                                    <thead>
                                                        <tr>
                                                            <th style="width: 40px; text-align: center; top: 0; position: relative; padding: 0;">
                                                               
                                                                <bk-checkbox name="check-all-instance" v-model="tpl.isAllChecked"
                                                                    v-if="tpl.instanceList && tpl.instanceList.length && tpl.instanceList.filter(item => item.state.islock === true).length === 0"
                                                                    @change="checkAllInstance(tpl, index, tmplMuster.templateList, ...arguments)" />
                                                                <bk-checkbox v-else name="check-all-instance" disabled="disabled" />
                                                            </th>
                                                            <th style="width: 120px; text-align: left;padding: 0">{{$t('plugin.tools.appName')}}</th>
                                                            <th style="width: 80px;">{{$t('generic.label.status')}}</th>
                                                            <th style="width: 60px;">{{$t('generic.label.kind')}}</th>
                                                            <th style="width: 100px;">{{$t('k8s.namespace')}}</th>
                                                            <th style="width: 70px;">{{$t('generic.label.version')}}</th>
                                                            <th style="width: 80px;">{{$t('deploy.templateset.totalInstances')}}
                                                                <bcs-popover placement="top" :delay="300">
                                                                    <i class="bcs-icon bcs-icon-info-circle tip"></i>
                                                                    <template slot="content">
                                                                        <p style="font-weight: 400;">{{$t('deploy.templateset.replicas')}}</p>
                                                                    </template>
                                                                </bcs-popover>
                                                            </th>
                                                            <th style="width: 130px;">{{$t('cluster.labels.createdAt')}}</th>
                                                            <th style="width: 190px; text-align: right; padding-right: 20px;">{{$t('generic.label.action')}}</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <template v-if="tpl.instanceList && tpl.instanceList.length">
                                                            <tr v-for="(instance, instanceIndex) in tpl.instanceList">
                                                                <td style="width: 40px; text-align: center; top: 0; position: relative;">
                                                                    
                                                                    <bk-checkbox name="check-instance" v-if="instance.state.islock === false"
                                                                        v-model="instance.isChecked"
                                                                        v-authority="{
                                                                            clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_delete,
                                                                            actionId: 'namespace_scoped_delete',
                                                                            resourceName: instance.namespace,
                                                                            disablePerms: true,
                                                                            permCtx: {
                                                                                project_id: projectId,
                                                                                cluster_id: instance.cluster_id,
                                                                                name: instance.namespace
                                                                            }
                                                                        }"
                                                                        @change="checkInstance(instance, instanceIndex, tpl, index, tmplMuster.templateList, ...arguments)" />
                                                                    <bk-checkbox v-else name="check-instance" disabled="disabled" />
                                                                </td>

                                                                <!-- backend_status: BackendError -->
                                                                <template v-if="instance.state.getRet().showError === true">
                                                                    <td style="text-align: left; padding-left: 0; font-weight: 700;">
                                                                        <bcs-popover placement="top">
                                                                            <a href="javascript:void(0);"
                                                                                class="bk-text-button instance-name"
                                                                                style="font-weight: 700;"
                                                                                v-authority="{
                                                                                    clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                        && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_view,
                                                                                    actionId: 'namespace_scoped_view',
                                                                                    resourceName: instance.namespace,
                                                                                    disablePerms: true,
                                                                                    permCtx: {
                                                                                        project_id: projectId,
                                                                                        cluster_id: instance.cluster_id,
                                                                                        name: instance.namespace
                                                                                    }
                                                                                }"
                                                                                @click="goInstanceDetail(instance)"
                                                                            >{{instance.name}}</a>
                                                                            <template slot="content">
                                                                                <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.name}}</p>
                                                                            </template>
                                                                        </bcs-popover>
                                                                    </td>
                                                                    <td style="white-space: nowrap;">
                                                                        <bcs-popover placement="top" :delay="500">
                                                                            <i class="bcs-icon bcs-icon-info-circle" style="font-size: 16px;color: #ff5656;position: absolute;top: -12px;left: -16px;"></i>
                                                                            <template slot="content">
                                                                                <p style="text-align: left; white-space: normal;word-break: break-all;font-weight:400;">{{instance.backend_status_message || $t('generic.status.error')}}</p>
                                                                            </template>
                                                                        </bcs-popover>
                                                                        <p style="display: inline-block;color: #ff5656;">CreateError</p>
                                                                    </td>
                                                                    <td>{{instance.category}}</td>
                                                                    <td>
                                                                        <bcs-popover placement="top" :delay="500">
                                                                            <p class="instance-namespace">{{instance.namespace}}</p>
                                                                            <template slot="content">
                                                                                <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.namespace}}</p>
                                                                            </template>
                                                                        </bcs-popover>
                                                                    </td>
                                                                    <td>
                                                                        <bcs-popover placement="top" :delay="500">
                                                                            <p class="instance-version">{{instance.version || '--'}}</p>
                                                                            <template slot="content">
                                                                                <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.version || '--'}}</p>
                                                                            </template>
                                                                        </bcs-popover>
                                                                    </td>
                                                                    <td>{{instance.build_instance}}/{{instance.instance}}</td>
                                                                    <td><p class="instance-createat">{{formatDate(instance.create_at)}}</p></td>
                                                                    <td class="act">
                                                                        <template v-if="instance.state.islock === true">
                                                                            <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                                {{$t('cluster.ca.nodePool.records.action.retry')}}
                                                                            </a>
                                                                            <a href="javascript:void(0)" class="bk-text-button is-disabled">
                                                                                {{$t('generic.button.delete')}}
                                                                            </a>
                                                                        </template>
                                                                        <template v-else-if="instance.state.islock === false">
                                                                            <a href="javascript:void(0);" class="bk-text-button" @click="reCreate(instance, instanceIndex, tpl.instanceList)">
                                                                                {{$t('cluster.ca.nodePool.records.action.retry')}}
                                                                            </a>
                                                                            <a href="javascript:void(0)" class="bk-text-button" @click="showDelete(instance, instanceIndex, tpl.instanceList)">
                                                                                {{$t('generic.button.delete')}}
                                                                            </a>
                                                                        </template>
                                                                    </td>
                                                                </template>

                                                                <!-- backend_status: BackendNormal -->
                                                                <template v-else>
                                                                    <template v-if="instance.state.getRet().showLoading === true">
                                                                        <td style="text-align: left; padding-left: 0; font-weight: 700;">
                                                                            <bcs-popover placement="top">
                                                                                <a href="javascript:void(0);" class="bk-text-button instance-name" style="font-weight: 700;"
                                                                                    v-authority="{
                                                                                        clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                            && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_view,
                                                                                        actionId: 'namespace_scoped_view',
                                                                                        resourceName: instance.namespace,
                                                                                        disablePerms: true,
                                                                                        permCtx: {
                                                                                            project_id: projectId,
                                                                                            cluster_id: instance.cluster_id,
                                                                                            name: instance.namespace
                                                                                        }
                                                                                    }" 
                                                                                    @click="goInstanceDetail(instance)">{{instance.name}}</a>
                                                                                <template slot="content">
                                                                                    <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.name}}</p>
                                                                                </template>
                                                                            </bcs-popover>
                                                                        </td>
                                                                        <td style="white-space: nowrap;position: relative;">
                                                                            <div style="margin-top: 1px;position: absolute;left: -10px;" class="bk-spin-loading bk-spin-loading-mini bk-spin-loading-warning">
                                                                                <div class="rotate rotate1"></div>
                                                                                <div class="rotate rotate2"></div>
                                                                                <div class="rotate rotate3"></div>
                                                                                <div class="rotate rotate4"></div>
                                                                                <div class="rotate rotate5"></div>
                                                                                <div class="rotate rotate6"></div>
                                                                                <div class="rotate rotate7"></div>
                                                                                <div class="rotate rotate8"></div>
                                                                            </div>
                                                                            <p style="color: #ffb400;">{{instance.status}}</p>
                                                                        </td>
                                                                    </template>
                                                                    <template v-else-if="instance.state.getRet().showLoading === false">
                                                                        <td style="text-align: left; padding: 0; font-weight: 700;">
                                                                            <bcs-popover placement="top">
                                                                                <a href="javascript:void(0);" class="bk-text-button instance-name" style="font-weight: 700;"
                                                                                    v-authority="{
                                                                                        clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                            && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_view,
                                                                                        actionId: 'namespace_scoped_view',
                                                                                        resourceName: instance.namespace,
                                                                                        disablePerms: true,
                                                                                        permCtx: {
                                                                                            project_id: projectId,
                                                                                            cluster_id: instance.cluster_id,
                                                                                            name: instance.namespace
                                                                                        }
                                                                                    }"  
                                                                                    @click="goInstanceDetail(instance)">{{instance.name}}</a>
                                                                                <template slot="content">
                                                                                    <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.name}}</p>
                                                                                </template>
                                                                            </bcs-popover>
                                                                        </td>
                                                                        <template v-if="instance.state.getRet().showError === true">
                                                                            <td style="white-space: nowrap;">
                                                                                <bcs-popover placement="top" :delay="500">
                                                                                    <i class="bcs-icon bcs-icon-info-circle" style="font-size: 16px;color: #ff5656;position: absolute;top: -12px;left: -16px;"></i>
                                                                                    <template slot="content">
                                                                                        <p style="text-align: left; white-space: normal;word-break: break-all;font-weight:400;">{{instance.status_message || $t('deploy.templateset.detail')}}</p>
                                                                                    </template>
                                                                                </bcs-popover>
                                                                                <p style="display: inline-block;color: #ff5656;">{{instance.status}}</p>
                                                                            </td>
                                                                        </template>
                                                                        <template v-else>
                                                                            <td style="white-space: nowrap;">
                                                                                <p>{{instance.status}}</p>
                                                                            </td>
                                                                        </template>
                                                                    </template>
                                                                    <!-- <td style="white-space: nowrap;">
                                                                        <p>{{instance.status}}</p>
                                                                    </td> -->
                                                                    <td>{{instance.category}}</td>
                                                                    <td>
                                                                        <bcs-popover placement="top" :delay="500">
                                                                            <p class="instance-namespace">{{instance.namespace}}</p>
                                                                            <template slot="content">
                                                                                <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.cluster_name}}</p>
                                                                            </template>
                                                                        </bcs-popover>
                                                                    </td>
                                                                    <td>
                                                                        <bcs-popover placement="top" :delay="500">
                                                                            <p class="instance-version">{{instance.version || '--'}}</p>
                                                                            <template slot="content">
                                                                                <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.version || '--'}}</p>
                                                                            </template>
                                                                        </bcs-popover>
                                                                    </td>
                                                                    <td>{{instance.build_instance}}/{{instance.instance}}</td>
                                                                    <td><p class="instance-createat">{{formatDate(instance.update_at)}}</p></td>
                                                                    <td class="act">
                                                                        <template v-if="instance.state.getRet().rollingupdate === 1">
                                                                            <template v-if="instance.state.islock === true">
                                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                                    {{$t('k8s.updateStrategy.rollingUpdate')}}
                                                                                </a>
                                                                            </template>
                                                                            <template v-if="instance.state.islock === false">
                                                                                <a href="javascript:void(0);" class="bk-text-button"
                                                                                    v-authority="{
                                                                                        clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                            && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_update,
                                                                                        actionId: 'namespace_scoped_update',
                                                                                        resourceName: instance.namespace,
                                                                                        disablePerms: true,
                                                                                        permCtx: {
                                                                                            project_id: projectId,
                                                                                            cluster_id: instance.cluster_id,
                                                                                            name: instance.namespace
                                                                                        }
                                                                                    }"
                                                                                    @click="showRollingUpdate(instance, instanceIndex, tpl.instanceList)">
                                                                                    {{$t('k8s.updateStrategy.rollingUpdate')}}
                                                                                </a>
                                                                            </template>
                                                                        </template>
                                                                        <template v-else-if="instance.state.getRet().rollingupdate === 0">
                                                                            <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                                {{$t('k8s.updateStrategy.rollingUpdate')}}
                                                                            </a>
                                                                        </template>

                                                                        <!-- <template v-if="instance.state.getRet().pause === 1">
                                                                            <template v-if="instance.state.islock === true">
                                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                                    {{$t('deploy.templateset.superseded')}}
                                                                                </a>
                                                                            </template>
                                                                            <template v-if="instance.state.islock === false">
                                                                                <a href="javascript:void(0);" class="bk-text-button"
                                                                                    @click="pauseRollingUpdate(instance, instanceIndex, tpl.instanceList)">
                                                                                    {{$t('deploy.templateset.superseded')}}
                                                                                </a>
                                                                            </template>
                                                                        </template>
                                                                        <template v-else-if="instance.state.getRet().pause === 0">
                                                                            <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                                {{$t('deploy.templateset.superseded')}}
                                                                            </a>
                                                                        </template> -->

                                                                        <template v-if="instance.state.getRet().resume === 1">
                                                                            <template v-if="instance.state.islock === true">
                                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled" style="margin-right: 55px;">
                                                                                    {{$t('deploy.templateset.uprade')}}
                                                                                </a>
                                                                            </template>
                                                                            <template v-if="instance.state.islock === false">
                                                                                <a href="javascript:void(0);" class="bk-text-button"
                                                                                    :style="{
                                                                                        marginRight: instance.status === 'Paused' && (instance.oper_type === 'rollingupdate' || instance.oper_type === 'pause')
                                                                                            ? '55px'
                                                                                            : '0'
                                                                                    }"
                                                                                    v-authority="{
                                                                                        clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                            && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_update,
                                                                                        actionId: 'namespace_scoped_update',
                                                                                        resourceName: instance.namespace,
                                                                                        disablePerms: true,
                                                                                        permCtx: {
                                                                                            project_id: projectId,
                                                                                            cluster_id: instance.cluster_id,
                                                                                            name: instance.namespace
                                                                                        }
                                                                                    }"
                                                                                    @click="resumeRollingUpdate(instance, instanceIndex, tpl.instanceList)">
                                                                                    {{$t('deploy.templateset.uprade')}}
                                                                                </a>
                                                                            </template>
                                                                        </template>
                                                                        <template v-else-if="instance.state.getRet().resume === 0">
                                                                            <a href="javascript:void(0);" class="bk-text-button is-disabled" style="margin-right: 55px;">
                                                                                {{$t('deploy.templateset.uprade')}}
                                                                            </a>
                                                                        </template>

                                                                        <!-- <template v-if="instance.state.getRet().cancel === 1">
                                                                            <template v-if="instance.state.islock === true">
                                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                                    :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}">
                                                                                    {{$t('deploy.templateset.cancel')}}
                                                                                </a>
                                                                            </template>
                                                                            <template v-if="instance.state.islock === false">
                                                                                <a href="javascript:void(0);" class="bk-text-button"
                                                                                    :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}"
                                                                                    @click="cancelRollingUpdate(instance, instanceIndex, tpl.instanceList)">
                                                                                    {{$t('deploy.templateset.cancel')}}
                                                                                </a>
                                                                            </template>
                                                                        </template>
                                                                        <template v-else-if="instance.state.getRet().cancel === 0">
                                                                            <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                                :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}">
                                                                                {{$t('deploy.templateset.cancel')}}
                                                                            </a>
                                                                        </template> -->

                                                                        <template v-if="CATEGORY !== 'daemonset'">
                                                                            <template v-if="instance.state.getRet().scale === 1">
                                                                                <template v-if="instance.state.islock === true">
                                                                                    <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                                        :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}">
                                                                                        {{$t('deploy.templateset.scale')}}
                                                                                    </a>
                                                                                </template>
                                                                                <template v-if="instance.state.islock === false">
                                                                                    <a href="javascript:void(0);" class="bk-text-button"
                                                                                        :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}"
                                                                                        v-authority="{
                                                                                            clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                                && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_update,
                                                                                            actionId: 'namespace_scoped_update',
                                                                                            resourceName: instance.namespace,
                                                                                            disablePerms: true,
                                                                                            permCtx: {
                                                                                                project_id: projectId,
                                                                                                cluster_id: instance.cluster_id,
                                                                                                name: instance.namespace
                                                                                            }
                                                                                        }"
                                                                                        @click="showInstanceNum(instance, instanceIndex, tpl.instanceList)">
                                                                                        {{$t('deploy.templateset.scale')}}
                                                                                    </a>
                                                                                </template>
                                                                            </template>
                                                                            <template v-else-if="instance.state.getRet().scale === 0">
                                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                                    :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}">
                                                                                    {{$t('deploy.templateset.scale')}}
                                                                                </a>
                                                                            </template>
                                                                        </template>
                                                                        <template v-else>
                                                                            <span style="display: inline-block; width: 50px;"> </span>
                                                                        </template>

                                                                        <template v-if="instance.state.getRet().rebuild === 1">
                                                                            <template v-if="instance.state.islock === true">
                                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled dropdown-menu">
                                                                                    {{$t('deploy.templateset.more')}}
                                                                                    <i class="bcs-icon bcs-icon-angle-down dropdown-menu-angle-down"></i>
                                                                                </a>
                                                                            </template>
                                                                            <template v-if="instance.state.islock === false">
                                                                                <bk-dropdown-menu class="dropdown-menu" :align="'center'" ref="dropdown">
                                                                                    <a href="javascript:void(0);" slot="dropdown-trigger" class="bk-text-button">
                                                                                        {{$t('deploy.templateset.more')}}
                                                                                        <i class="bcs-icon bcs-icon-angle-down dropdown-menu-angle-down"></i>
                                                                                    </a>
                                                                                    <ul class="bk-dropdown-list" slot="dropdown-content">
                                                                                        <li v-if="instance.from_platform === true">
                                                                                            <a href="javascript:void(0)"
                                                                                                v-authority="{
                                                                                                    clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                                        && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_update,
                                                                                                    actionId: 'namespace_scoped_update',
                                                                                                    resourceName: instance.namespace,
                                                                                                    disablePerms: true,
                                                                                                    permCtx: {
                                                                                                        project_id: projectId,
                                                                                                        cluster_id: instance.cluster_id,
                                                                                                        name: instance.namespace
                                                                                                    }
                                                                                                }"
                                                                                                @click="showRollbackPrevious(instance, instanceIndex, tpl.instanceList)"
                                                                                            >{{$t('deploy.templateset.rollback')}}</a>
                                                                                        </li>
                                                                                        <li>
                                                                                            <a href="javascript:void(0)"
                                                                                                @click="showReBuild(instance, instanceIndex, tpl.instanceList)"
                                                                                                v-authority="{
                                                                                                    clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                                        && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_delete,
                                                                                                    actionId: 'namespace_scoped_delete',
                                                                                                    resourceName: instance.namespace,
                                                                                                    disablePerms: true,
                                                                                                    permCtx: {
                                                                                                        project_id: projectId,
                                                                                                        cluster_id: instance.cluster_id,
                                                                                                        name: instance.namespace
                                                                                                    }
                                                                                                }"
                                                                                            >{{$t('deploy.templateset.recreate')}}</a>
                                                                                        </li>
                                                                                        <li>
                                                                                            <a href="javascript:void(0)"
                                                                                                v-authority="{
                                                                                                    clickable: templateInstanceWebAnnotations.perms[instance.iam_ns_id]
                                                                                                        && templateInstanceWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_delete,
                                                                                                    actionId: 'namespace_scoped_delete',
                                                                                                    resourceName: instance.namespace,
                                                                                                    disablePerms: true,
                                                                                                    permCtx: {
                                                                                                        project_id: projectId,
                                                                                                        cluster_id: instance.cluster_id,
                                                                                                        name: instance.namespace
                                                                                                    }
                                                                                                }"
                                                                                                @click="showDelete(instance, instanceIndex, tpl.instanceList)"
                                                                                            >{{$t('generic.button.delete')}}</a>
                                                                                        </li>
                                                                                    </ul>
                                                                                </bk-dropdown-menu>
                                                                            </template>
                                                                        </template>
                                                                        <template v-else-if="instance.state.getRet().rebuild === 0">
                                                                            <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                                {{$t('deploy.templateset.more')}}
                                                                                <i class="bcs-icon bcs-icon-angle-down dropdown-menu-angle-down"></i>
                                                                            </a>
                                                                        </template>
                                                                    </td>
                                                                </template>
                                                            </tr>
                                                        </template>
                                                        <template v-else>
                                                            <tr>
                                                                <td colspan="9">
                                                                    <div class="bk-message-box">
                                                                        <bcs-exception type="empty" scene="part" v-if="!instanceLoading"></bcs-exception>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </template>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                                <template v-if="!tmplMuster.templateLoading && (!tmplMuster.templateList || !tmplMuster.templateList.length)">
                                    <div class="list-item-tpl">
                                        <div class="no-data-list-item-tpl-inner">
                                            {{$t('generic.msg.empty.noData1')}}
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
                <div class="biz-app-list" v-if="!tmplMusterList.length && !showLoading">
                    <div class="bk-message-box">
                        <bcs-exception type="empty" scene="part" v-if="!instanceLoading"></bcs-exception>
                    </div>
                </div>
            </template>

            <!-------------------------------- 命名空间视图 -------------------------------->
            <template v-else>
                <p class="biz-tip ml20 mb20">
                    <i class="bcs-icon bcs-icon-alarm-insufficient vm"></i>
                    <span class="vm">{{$t('deploy.templateset.appInfo')}}</span>
                </p>
                <div class="biz-app-namespace-list k8s" v-if="namespaceList.length">
                    <div class="list-item-tplset" :class="namespace.isOpen ? 'expand' : ''"
                        v-for="(namespace, namespaceIndex) in namespaceList">
                        <div class="list-item-tplset-inner"
                            v-authority="{
                                clickable: namespaceWebAnnotations.perms[namespace.iam_ns_id]
                                    && namespaceWebAnnotations.perms[namespace.iam_ns_id].namespace_scoped_view,
                                actionId: 'namespace_scoped_view',
                                resourceName: namespace.name,
                                disablePerms: true,
                                permCtx: {
                                    project_id: projectId,
                                    cluster_id: namespace.cluster_id,
                                    name: namespace.name
                                }
                            }"
                            @click="toggleNamespace(namespace, namespaceIndex)"
                        >
                            <div class="app-name" :title="namespace.name">
                                <span class="name">{{namespace.name}}</span>
                                <span class="app-env">
                                    <span class="left">{{namespace.cluster_name}}</span>
                                    <span class="right">{{namespace.env_type === 'stag' ? $t('cluster.tag.debug') : $t('cluster.tag.prod')}}</span>
                                </span>
                            </div>
                            <div class="app-desc">
                                {{$t('deploy.templateset.appTotalCounts', { total: namespace.total_num })}} {{namespace.error_num === 0 ? $t('deploy.templateset.normal') : $t('deploy.templateset.errCounts', { total: namespace.error_num })}}
                            </div>
                            <div class="app-act">
                                <template v-if="namespace.appList && namespace.appList.length && namespace.appList.filter(item => item.isChecked === true).length > 0">
                                    <a href="javascript:void(0);" class="bk-text-button" @click.stop="showBatchReBuild(namespace, namespaceIndex)">
                                        {{$t('deploy.templateset.multiRecreate')}}
                                    </a>
                                    <a href="javascript:void(0);" class="bk-text-button" @click.stop="batchDelete4Namespace(namespace, namespaceIndex)">
                                        {{$t('generic.button.batchDelete')}}
                                    </a>
                                </template>
                                <template v-else>
                                    <a href="javascript:void(0);" class="bk-text-button is-disabled">{{$t('deploy.templateset.multiRecreate')}}</a>
                                    <a href="javascript:void(0);" class="bk-text-button is-disabled">{{$t('generic.button.batchDelete')}}</a>
                                </template>
                            </div>
                            <div class="app-toggle">
                                <i class="bcs-icon" :class="namespace.isOpen ? 'bcs-icon-angle-up' : 'bcs-icon-angle-down'"></i>
                            </div>
                        </div>

                        <!-- list-item-tpl -->
                        <template v-if="namespace.isOpen">
                            <div class="list-item-tpl">
                                <div class="list-item-tpl-table loading" v-if="namespace.appLoading" v-bkloading="{ isLoading: true }">
                                </div>
                                <div class="list-item-tpl-table" v-else v-bkloading="{ isLoading: false }">
                                    <table class="bk-table has-table-hover biz-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 40px; text-align: center; top: 0; position: relative; padding: 0;">
                                                    <label class="bk-form-checkbox">
                                                        <bk-checkbox name="check-all-app-instance" v-model="namespace.isAllChecked"
                                                            v-if="namespace.appList && namespace.appList.length && namespace.appList.filter(item => item.state.islock === true).length === 0"
                                                            @change="checkAllNamespace(namespace, namespaceIndex, namespaceList, ...arguments)" />
                                                        <bk-checkbox v-else name="check-all-app-instance" disabled="disabled" />
                                                    </label>
                                                </th>
                                                <th style="width: 120px; text-align: left; padding: 10px;">
                                                    {{$t('plugin.tools.appName')}}
                                                </th>
                                                <th style="width: 70px;">{{$t('generic.label.status')}}</th>
                                                <th style="width: 90px;">{{$t('deploy.templateset.sources')}}</th>
                                                <th style="width: 70px;">{{$t('generic.label.version')}}</th>
                                                <th style="width: 80px;">{{$t('deploy.templateset.appCounts')}}
                                                    <bcs-popover placement="top" :delay="300">
                                                        <i class="bcs-icon bcs-icon-info-circle tip"></i>
                                                        <template slot="content">
                                                            <p style="font-weight: 400;">{{$t('deploy.templateset.replicas')}}</p>
                                                        </template>
                                                    </bcs-popover>
                                                </th>
                                                <th style="width: 90px;">{{$t('cluster.labels.createdAt')}}</th>
                                                <th style="width: 200px; text-align: right; padding-right: 20px;">{{$t('generic.label.action')}}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template v-if="namespace.appList && namespace.appList.length">
                                                <tr v-for="(instance, instanceIndex) in namespace.appList">
                                                    <td style="width: 40px; text-align: center; top: 0; position: relative;">
                                                        <bk-checkbox name="check-app-instance"
                                                            v-if="instance.state.islock === false"
                                                            v-model="instance.isChecked"
                                                            v-authority="{
                                                                clickable: namespaceInsWebAnnotations.perms[instance.iam_ns_id]
                                                                    && namespaceInsWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_delete,
                                                                actionId: 'namespace_scoped_delete',
                                                                resourceName: instance.namespace,
                                                                disablePerms: true,
                                                                permCtx: {
                                                                    project_id: projectId,
                                                                    cluster_id: instance.cluster_id,
                                                                    name: instance.namespace
                                                                }
                                                            }"
                                                            @change="checkNamespace(instance, instanceIndex, namespace, namespaceIndex, namespaceList, ...arguments)" />
                                                        <bk-checkbox v-else name="check-app-instance" disabled="disabled" />
                                                    </td>
                                                    <!-- backend_status: BackendError -->
                                                    <template v-if="instance.backend_status === 'BackendError'">
                                                        <td style="text-align: left;">
                                                            <bcs-popover placement="top">
                                                                <a href="javascript:void(0);" class="bk-text-button instance-name" style="font-weight: 700;" @click="goInstanceDetail(instance, namespace)">{{instance.name}}</a>
                                                                <template slot="content">
                                                                    <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.name}}</p>
                                                                </template>
                                                            </bcs-popover>
                                                        </td>
                                                        <td style="white-space: nowrap;">
                                                            <bcs-popover placement="top-start" :delay="500">
                                                                <i class="bcs-icon bcs-icon-info-circle" style="font-size: 16px;color: #ff5656;position: absolute;top: -12px;left: -16px;"></i>
                                                                <template slot="content">
                                                                    <p style="text-align: left; white-space: normal;word-break: break-all;font-weight:400;">{{instance.backend_status_message || $t('generic.status.error')}}</p>
                                                                </template>
                                                            </bcs-popover>
                                                            <p style="display: inline-block;color: #ff5656;">CreateError</p>
                                                        </td>
                                                        <td>{{instance.source_type || '--'}}</td>
                                                        <td>
                                                            <bcs-popover placement="top" :delay="500">
                                                                <p class="instance-version">{{instance.version || '--'}}</p>
                                                                <template slot="content">
                                                                    <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.version || '--'}}</p>
                                                                </template>
                                                            </bcs-popover>
                                                        </td>
                                                        <td>{{instance.build_instance}}/{{instance.instance}}</td>
                                                        <td><p class="instance-createat">{{formatDate(instance.create_at)}}</p></td>
                                                        <td class="act">
                                                            <template v-if="instance.state.islock === true">
                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                    {{$t('cluster.ca.nodePool.records.action.retry')}}
                                                                </a>
                                                                <a href="javascript:void(0)" class="bk-text-button is-disabled">
                                                                    {{$t('generic.button.delete')}}
                                                                </a>
                                                            </template>
                                                            <template v-else-if="instance.state.islock === false">
                                                                <a href="javascript:void(0);" class="bk-text-button" @click="reCreate(instance, instanceIndex, namespace.appList)">
                                                                    {{$t('cluster.ca.nodePool.records.action.retry')}}
                                                                </a>
                                                                <a href="javascript:void(0)" class="bk-text-button" @click="showDelete(instance, instanceIndex, namespace.appList)">
                                                                    {{$t('generic.button.delete')}}
                                                                </a>
                                                            </template>
                                                        </td>
                                                    </template>

                                                    <!-- backend_status: BackendNormal -->
                                                    <template v-else>
                                                        <template v-if="instance.state.getRet().showLoading === true">
                                                            <td style="text-align: left;">
                                                                <bcs-popover placement="top">
                                                                    <a href="javascript:void(0);" class="bk-text-button instance-name" style="font-weight: 700;" @click="goInstanceDetail(instance, namespace)">{{instance.name}}</a>
                                                                    <template slot="content">
                                                                        <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.name}}</p>
                                                                    </template>
                                                                </bcs-popover>
                                                            </td>
                                                            <td style="white-space: nowrap;position: relative;">
                                                                <div style="margin-top: 1px;position: absolute;left: -10px;" class="bk-spin-loading bk-spin-loading-mini bk-spin-loading-warning">
                                                                    <div class="rotate rotate1"></div>
                                                                    <div class="rotate rotate2"></div>
                                                                    <div class="rotate rotate3"></div>
                                                                    <div class="rotate rotate4"></div>
                                                                    <div class="rotate rotate5"></div>
                                                                    <div class="rotate rotate6"></div>
                                                                    <div class="rotate rotate7"></div>
                                                                    <div class="rotate rotate8"></div>
                                                                </div>
                                                                <p style="color: #ffb400;">{{instance.status}}</p>
                                                            </td>
                                                        </template>
                                                        <template v-else>
                                                            <template v-if="instance.state.getRet().showError === true">
                                                                <td style="text-align: left;">
                                                                    <bcs-popover placement="top">
                                                                        <a href="javascript:void(0);" class="bk-text-button instance-name" style="font-weight: 700;" @click="goInstanceDetail(instance, namespace)">{{instance.name}}</a>
                                                                        <template slot="content">
                                                                            <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.name}}</p>
                                                                        </template>
                                                                    </bcs-popover>
                                                                </td>
                                                                <td style="white-space: nowrap;">
                                                                    <bcs-popover placement="top" :delay="500">
                                                                        <i class="bcs-icon bcs-icon-info-circle" style="font-size: 16px;color: #ff5656;position: absolute;top: -12px;left: -16px;"></i>
                                                                        <template slot="content">
                                                                            <p style="text-align: left; white-space: normal;word-break: break-all;font-weight:400;">{{instance.status_message || $t('deploy.templateset.detail')}}</p>
                                                                        </template>
                                                                    </bcs-popover>
                                                                    <p style="display: inline-block;color: #ff5656;">{{instance.status}}</p>
                                                                </td>
                                                            </template>
                                                            <template v-else>
                                                                <td style="text-align: left;">
                                                                    <bcs-popover placement="top">
                                                                        <a href="javascript:void(0);" class="bk-text-button instance-name" style="font-weight: 700;" @click="goInstanceDetail(instance, namespace)">{{instance.name}}</a>
                                                                        <template slot="content">
                                                                            <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.name}}</p>
                                                                        </template>
                                                                    </bcs-popover>
                                                                </td>
                                                                <td style="white-space: nowrap;">
                                                                    <p>{{instance.status}}</p>
                                                                </td>
                                                            </template>
                                                        </template>
                                                        <td>{{instance.source_type || '--'}}</td>
                                                        <td>
                                                            <bcs-popover placement="top" :delay="500">
                                                                <p class="instance-version">{{instance.version || '--'}}</p>
                                                                <template slot="content">
                                                                    <p style="text-align: left; white-space: normal;word-break: break-all;">{{instance.version || '--'}}</p>
                                                                </template>
                                                            </bcs-popover>
                                                        </td>
                                                        <td>{{instance.build_instance}}/{{instance.instance}}</td>
                                                        <td><p class="instance-createat">{{formatDate(instance.update_at)}}</p></td>
                                                        <td class="act">
                                                            <template v-if="instance.state.getRet().rollingupdate === 1">
                                                                <template v-if="instance.state.islock === true">
                                                                    <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                        {{$t('k8s.updateStrategy.rollingUpdate')}}
                                                                    </a>
                                                                </template>
                                                                <template v-if="instance.state.islock === false">
                                                                    <a href="javascript:void(0);" class="bk-text-button"
                                                                        v-authority="{
                                                                            clickable: namespaceInsWebAnnotations.perms[instance.iam_ns_id]
                                                                                && namespaceInsWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_update,
                                                                            actionId: 'namespace_scoped_update',
                                                                            resourceName: instance.namespace,
                                                                            disablePerms: true,
                                                                            permCtx: {
                                                                                project_id: projectId,
                                                                                cluster_id: instance.cluster_id,
                                                                                name: instance.namespace
                                                                            }
                                                                        }"
                                                                        @click="showRollingUpdate(instance, instanceIndex, namespace.appList)">
                                                                        {{$t('k8s.updateStrategy.rollingUpdate')}}
                                                                    </a>
                                                                </template>
                                                            </template>
                                                            <template v-else-if="instance.state.getRet().rollingupdate === 0">
                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                    {{$t('k8s.updateStrategy.rollingUpdate')}}
                                                                </a>
                                                            </template>

                                                            <!-- <template v-if="instance.state.getRet().pause === 1">
                                                                <template v-if="instance.state.islock === true">
                                                                    <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                        {{$t('deploy.templateset.superseded')}}
                                                                    </a>
                                                                </template>
                                                                <template v-if="instance.state.islock === false">
                                                                    <a href="javascript:void(0);" class="bk-text-button"
                                                                        @click="pauseRollingUpdate(instance, instanceIndex, namespace.appList)">
                                                                        {{$t('deploy.templateset.superseded')}}
                                                                    </a>
                                                                </template>
                                                            </template>
                                                            <template v-else-if="instance.state.getRet().pause === 0">
                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                    {{$t('deploy.templateset.superseded')}}
                                                                </a>
                                                            </template> -->

                                                            <template v-if="instance.state.getRet().resume === 1">
                                                                <template v-if="instance.state.islock === true">
                                                                    <a href="javascript:void(0);" class="bk-text-button is-disabled" style="margin-right: 55px;">
                                                                        {{$t('deploy.templateset.uprade')}}
                                                                    </a>
                                                                </template>
                                                                <template v-if="instance.state.islock === false">
                                                                    <a href="javascript:void(0);" class="bk-text-button"
                                                                        :style="{
                                                                            marginRight: instance.status === 'Paused' && (instance.oper_type === 'rollingupdate' || instance.oper_type === 'pause')
                                                                                ? '55px'
                                                                                : '0'
                                                                        }"
                                                                        v-authority="{
                                                                            clickable: namespaceInsWebAnnotations.perms[instance.iam_ns_id]
                                                                                && namespaceInsWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_update,
                                                                            actionId: 'namespace_scoped_update',
                                                                            resourceName: instance.namespace,
                                                                            disablePerms: true,
                                                                            permCtx: {
                                                                                project_id: projectId,
                                                                                cluster_id: instance.cluster_id,
                                                                                name: instance.namespace
                                                                            }
                                                                        }"
                                                                        @click="resumeRollingUpdate(instance, instanceIndex, namespace.appList)">
                                                                        {{$t('deploy.templateset.uprade')}}
                                                                    </a>
                                                                </template>
                                                            </template>
                                                            <template v-else-if="instance.state.getRet().resume === 0">
                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled"  style="margin-right: 55px;">
                                                                    {{$t('deploy.templateset.uprade')}}
                                                                </a>
                                                            </template>

                                                            <!-- <template v-if="instance.state.getRet().cancel === 1">
                                                                <template v-if="instance.state.islock === true">
                                                                    <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                        :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}">
                                                                        {{$t('deploy.templateset.cancel')}}
                                                                    </a>
                                                                </template>
                                                                <template v-if="instance.state.islock === false">
                                                                    <a href="javascript:void(0);" class="bk-text-button"
                                                                        :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}"
                                                                        @click="cancelRollingUpdate(instance, instanceIndex, namespace.appList)">
                                                                        {{$t('deploy.templateset.cancel')}}
                                                                    </a>
                                                                </template>
                                                            </template>
                                                            <template v-else-if="instance.state.getRet().cancel === 0">
                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                    :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}">
                                                                    {{$t('deploy.templateset.cancel')}}
                                                                </a>
                                                            </template> -->

                                                            <template v-if="CATEGORY !== 'daemonset'">
                                                                <template v-if="instance.state.getRet().scale === 1">
                                                                    <template v-if="instance.state.islock === true">
                                                                        <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                            :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}">
                                                                            {{$t('deploy.templateset.scale')}}
                                                                        </a>
                                                                    </template>
                                                                    <template v-if="instance.state.islock === false">
                                                                        <a href="javascript:void(0);" class="bk-text-button"
                                                                            :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}"
                                                                            v-authority="{
                                                                                clickable: namespaceInsWebAnnotations.perms[instance.iam_ns_id]
                                                                                    && namespaceInsWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_update,
                                                                                actionId: 'namespace_scoped_update',
                                                                                resourceName: instance.namespace,
                                                                                disablePerms: true,
                                                                                permCtx: {
                                                                                    project_id: projectId,
                                                                                    cluster_id: instance.cluster_id,
                                                                                    name: instance.namespace
                                                                                }
                                                                            }"
                                                                            @click="showInstanceNum(instance, instanceIndex, namespace.appList)">
                                                                            {{$t('deploy.templateset.scale')}}
                                                                        </a>
                                                                    </template>
                                                                </template>
                                                                <template v-else-if="instance.state.getRet().scale === 0">
                                                                    <template v-if="instance.hpa">
                                                                        <bcs-popover class="mr10" :content="$t('deploy.templateset.hpa')" placement="top">
                                                                            <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                                :style="{marginRight: instance.state.getRet().rebuild === 1 ? '45px' : '0', marginLeft: instance.state.getRet().rebuild === 1 ? '15px' : '0'}">
                                                                                {{$t('deploy.templateset.scale')}}
                                                                            </a>
                                                                        </bcs-popover>
                                                                    </template>
                                                                    <template v-else>
                                                                        <a href="javascript:void(0);" class="bk-text-button is-disabled"
                                                                            :style="{marginRight: instance.state.getRet().rebuild === 1 ? '55px' : '0'}">
                                                                            {{$t('deploy.templateset.scale')}}
                                                                        </a>
                                                                    </template>
                                                                </template>
                                                            </template>
                                                            <template v-else>
                                                                <span style="display: inline-block; width: 50px;"> </span>
                                                            </template>

                                                            <template v-if="instance.state.getRet().rebuild === 1">
                                                                <template v-if="instance.state.islock === true">
                                                                    <a href="javascript:void(0);" class="bk-text-button is-disabled dropdown-menu">
                                                                        {{$t('deploy.templateset.more')}}
                                                                        <i class="bcs-icon bcs-icon-angle-down dropdown-menu-angle-down"></i>
                                                                    </a>
                                                                </template>
                                                                <template v-if="instance.state.islock === false">
                                                                    <bk-dropdown-menu class="dropdown-menu" 
                                                                        :align="'center'" 
                                                                        ref="dropdown"
                                                                        v-authority="{
                                                                            clickable: namespaceInsWebAnnotations.perms[instance.iam_ns_id]
                                                                                && namespaceInsWebAnnotations.perms[instance.iam_ns_id].namespace_scoped_delete,
                                                                            actionId: 'namespace_scoped_delete',
                                                                            resourceName: instance.namespace,
                                                                            disablePerms: true,
                                                                            permCtx: {
                                                                                project_id: projectId,
                                                                                cluster_id: instance.cluster_id,
                                                                                name: instance.namespace
                                                                            }
                                                                        }">
                                                                        <a href="javascript:void(0);" slot="dropdown-trigger" class="bk-text-button">
                                                                            {{$t('deploy.templateset.more')}}
                                                                            <i class="bcs-icon bcs-icon-angle-down dropdown-menu-angle-down"></i>
                                                                        </a>
                                                                        <ul class="bk-dropdown-list" slot="dropdown-content">
                                                                            <li>
                                                                                <a href="javascript:void(0)" @click="showReBuild(instance, instanceIndex, namespace.appList)">{{$t('deploy.templateset.recreate')}}</a>
                                                                            </li>
                                                                            <li>
                                                                                <a href="javascript:void(0)" @click="showDelete(instance, instanceIndex, namespace.appList)">{{$t('generic.button.delete')}}</a>
                                                                            </li>
                                                                        </ul>
                                                                    </bk-dropdown-menu>
                                                                </template>
                                                            </template>
                                                            <template v-else-if="instance.state.getRet().rebuild === 0">
                                                                <a href="javascript:void(0);" class="bk-text-button is-disabled">
                                                                    {{$t('deploy.templateset.more')}}
                                                                    <i class="bcs-icon bcs-icon-angle-down dropdown-menu-angle-down"></i>
                                                                </a>
                                                            </template>
                                                        </td>
                                                    </template>
                                                </tr>
                                            </template>
                                            <template v-else>
                                                <tr>
                                                    <td colspan="9">
                                                        <div class="bk-message-box">
                                                            <bcs-exception type="empty" scene="part" v-if="!namespace.appLoading"></bcs-exception>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                <div class="biz-app-list" v-if="!namespaceList.length && !showLoading">
                    <div class="bk-message-box">
                        <bcs-exception type="empty" scene="part" v-if="!instanceLoading"></bcs-exception>
                    </div>
                </div>
            </template>
        </div>
        <!-- </template> -->
    </div>

    <bk-dialog
        :position="{ top: 100 }"
        :is-show.sync="rollingUpdateDialogConf.isShow"
        :width="rollingUpdateDialogConf.width"
        :title="rollingUpdateDialogConf.title"
        :close-icon="rollingUpdateDialogConf.closeIcon"
        :ext-cls="'biz-rolling-update-dialog'"
        :quick-close="false"
        @confirm="rollingUpdateConfirm"
        @cancel="hideRollingUpdate">
        <template slot="content">
            <div v-bkloading="{isLoading: rollingUpdateDialogConf.loading, opacity: 1}" style="min-height: 455px;">
                <div class="title-wrapper">
                    <div class="left">
                        <span style="margin-right: 40px;">{{$t('generic.label.currentVersion1')}}{{rollingUpdateDialogConf.oldVer}}</span>
                        <span v-if="CATEGORY !== 'daemonset'">{{$t('deploy.templateset.totalCounts')}}{{curInstance.instance}}</span>
                    </div>
                    <div class="right">{{$t('deploy.templateset.updateVer')}}
                        <div class="dropdown">
                            <bk-selector
                                :style="{width: CATEGORY !== 'daemonset' ? '190px' : '330px'}"
                                :placeholder="$t('deploy.templateset.selectVer')"
                                :list="rollingUpdateDialogConf.verList"
                                :selected.sync="rollingUpdateDialogConf.selectedVerId"
                                :setting-key="'id'"
                                :searchable="true"
                                :display-key="'name'"
                                :search-key="'name'"
                                @item-selected="verSelected">
                            </bk-selector>
                        </div>
                        <span v-if="CATEGORY !== 'daemonset'">
                            {{$t('deploy.templateset.totalCounts')}}
                            <template v-if="rollingUpdateDialogConf.newVersion.instance_num_var_flag">
                                <template v-if="curInstance.hpa">
                                    <bcs-popover :content="$t('deploy.templateset.hpa')" placement="top">
                                        <bk-input
                                            v-model="rollingUpdateDialogConf.newVersion.instance_num"
                                            :min="1"
                                            :max="1000"
                                            :disabled="curInstance.hpa"
                                            :style="{width: '80px'}"
                                            type="number"
                                            :placeholder="$t('generic.placeholder.input')">
                                        </bk-input>
                                    </bcs-popover>
                                </template>
                                <template v-else>
                                    <bk-input
                                        type="number"
                                        v-model="rollingUpdateDialogConf.newVersion.instance_num"
                                        :min="1"
                                        :max="1000"
                                        :disabled="curInstance.hpa"
                                        :style="{width: '80px'}"
                                        :placeholder="$t('generic.placeholder.input')">
                                    </bk-input>
                                </template>
                            </template>
                            <template v-else>
                                <template v-if="curInstance.hpa">
                                    <bcs-popover :content="$t('deploy.templateset.hpa')" placement="top">
                                        <bk-input
                                            type="number"
                                            v-model="rollingUpdateDialogConf.newVersion.instance_num"
                                            :min="1"
                                            :max="1000"
                                            :disabled="curInstance.hpa"
                                            :style="{width: '80px'}"
                                            :placeholder="$t('generic.placeholder.input')"
                                            @change="instanceNumChange">
                                        </bk-input>
                                    </bcs-popover>
                                </template>
                                <template v-else>
                                    <bk-input
                                        type="number"
                                        v-model="rollingUpdateDialogConf.newVersion.instance_num"
                                        :min="1"
                                        :max="1000"
                                        :disabled="curInstance.hpa"
                                        :style="{width: '80px'}"
                                        :placeholder="$t('generic.placeholder.input')"
                                        @change="instanceNumChange">
                                    </bk-input>
                                </template>
                            </template>
                        </span>
                        <a href="javascript:void(0)" class="bk-text-button" style="margin-left: 5px;" @click="toggleVariable"
                            v-if="(rollingUpdateDialogConf.oldVariableList && rollingUpdateDialogConf.oldVariableList.length) || (rollingUpdateDialogConf.newVariableList && rollingUpdateDialogConf.newVariableList.length)"
                            >
                            <i class="bcs-icon bcs-icon-edit2"></i>{{$t('deploy.variable.edit')}}
                        </a>
                        <template v-else>
                            <bcs-popover :content="$t('deploy.templateset.templateNotReferenced')" :delay="500" placement="top">
                                <a href="javascript:void(0)" class="bk-text-button is-disabled" style="margin-left: 5px;">
                                    <i class="bcs-icon bcs-icon-edit2"></i>{{$t('deploy.variable.edit')}}
                                </a>
                            </bcs-popover>
                        </template>
                    </div>
                </div>
                <div class="variable-wrapper" v-if="rollingUpdateDialogConf.isShowVariable">
                    <div class="left">
                        <template v-if="rollingUpdateDialogConf.oldVariableList && rollingUpdateDialogConf.oldVariableList.length">
                            <div class="biz-key-value-wrapper">
                                <div class="biz-key-value-item" v-for="(variable, index) in rollingUpdateDialogConf.oldVariableList">
                                    <input type="text" class="bk-form-input" disabled v-model="variable.key">
                                    <span class="equals-sign">=</span>
                                    <input type="text" class="bk-form-input right" :placeholder="$t('generic.label.value')" disabled v-model="variable.value">
                                </div>
                            </div>
                        </template>
                    </div>
                    <div class="right">
                        <template v-if="rollingUpdateDialogConf.newVariableList && rollingUpdateDialogConf.newVariableList.length">
                            <div class="biz-key-value-wrapper">
                                <div class="biz-key-value-item" v-for="(variable, index) in rollingUpdateDialogConf.newVariableList">
                                    <input type="text" class="bk-form-input" disabled v-model="variable.key">
                                    <span class="equals-sign">=</span>
                                    <template v-if="CATEGORY !== 'daemonset' && rollingUpdateDialogConf.newVersion.instance_num_var_flag && variable.key === rollingUpdateDialogConf.newVersion.instance_num_key">
                                        <bk-input
                                            type="number"
                                            v-model="variable.value"
                                            :min="0"
                                            :style="{width: '210px'}"
                                            :placeholder="$t('generic.label.value')"
                                            @change="instanceNumVarChange">
                                        </bk-input>
                                    </template>
                                    <template v-else>
                                        <input type="text" class="bk-form-input right" :placeholder="$t('generic.label.value')" v-model="variable.value">
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                <div class="diff-wrapper">
                    <monaco-editor
                        ref="yamlEditor"
                        class="editor"
                        theme="monokai"
                        language="yaml"
                        style="height: 400px; width: 100%"
                        v-model="rollingUpdateDialogConf.newContent"
                        :diff-editor="useEditorDiff"
                        :options="yamlEditorOptions"
                        :key="reRenderEditor"
                        :original="rollingUpdateDialogConf.oldContent"
                        @mounted="handleEditorMount">
                    </monaco-editor>
                </div>
            </div>
        </template>
        <div slot="footer">
            <div class="bk-dialog-outer">
                <div class="no-diff-msg">{{rollingUpdateDialogConf.noDiffMsg}}</div>
                <template v-if="isUpdating">
                    <bk-button type="primary" :loading="isUpdating">
                        {{$t('generic.status.updating')}}
                    </bk-button>
                    <bk-button type="button" disabled>
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
                <template v-else>
                    <bk-button type="primary"
                        @click="rollingUpdateConfirm">
                        {{$t('generic.button.confirm')}}
                    </bk-button>
                    <bk-button type="button" @click="hideRollingUpdate">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
            </div>
        </div>
    </bk-dialog>

    <bk-dialog
        :position="{ top: 100 }"
        :is-show.sync="rollingUpdateInNotPlatformDialogConf.isShow"
        :width="rollingUpdateInNotPlatformDialogConf.width"
        :title="rollingUpdateInNotPlatformDialogConf.title"
        :close-icon="rollingUpdateInNotPlatformDialogConf.closeIcon"
        :ext-cls="'biz-rolling-update-dialog'"
        :quick-close="false"
        @confirm="rollingUpdateInNotPlatformConfirm"
        @cancel="hideRollingUpdateInNotPlatform">
        <template slot="content">
            <div v-bkloading="{isLoading: rollingUpdateInNotPlatformDialogConf.loading}" style="min-height: 505px;">
                <div class="biz-code-wrapper" v-if="!rollingUpdateInNotPlatformDialogConf.loading">
                    <div class="toggle-diff-edit">
                        <a href="javascript:void(0);" class="bk-text-button" @click="toggleDiffEdit">{{rollingUpdateInNotPlatformDialogConf.toggleStr}}</a>
                    </div>
                    <template v-if="rollingUpdateInNotPlatformDialogConf.showType === 'diff'">
                        <div class="diff-wrapper" style="margin-top: 26px;">
                            <monaco-editor
                                ref="jsonEditor"
                                class="editor"
                                theme="monokai"
                                language="json"
                                style="height: 480px; width: 100%"
                                v-model="editorValue"
                                :diff-editor="true"
                                :options="yamlEditorOptions"
                                :key="reRenderJSONEditor"
                                :original="compareEditorConfig.value"
                                @mounted="handleEditorMount">
                            </monaco-editor>
                        </div>
                    </template>
                    <template v-else>
                        <div class="left">
                            <div class="rolling-update-in-not-platform-tip"><i class="bcs-icon bcs-icon-info-circle"></i>{{$t('deploy.templateset.currentOnlineConfig')}}</div>
                            <div class="build-code-fullscreen" :title="$t('generic.button.fullScreen.text')" @click="setFullScreen('compareEditor')">
                                <i class="bcs-icon bcs-icon-full-screen"></i>
                            </div>
                            <ace
                                :value="compareEditorConfig.value"
                                :width="compareEditorConfig.width"
                                :height="compareEditorConfig.height"
                                :lang="compareEditorConfig.lang"
                                :read-only="compareEditorConfig.readOnly"
                                :full-screen="compareEditorConfig.fullScreen"
                                @init="editorInitAfterForCompare">
                            </ace>
                        </div>
                        <div class="right">
                            <div class="rolling-update-in-not-platform-tip"><i class="bcs-icon bcs-icon-info-circle"></i>{{$t('deploy.templateset.confirmToUpdateConfig')}}</div>
                            <div class="build-code-fullscreen" :title="$t('generic.button.fullScreen.text')" @click="setFullScreen('editor')">
                                <i class="bcs-icon bcs-icon-full-screen"></i>
                            </div>
                            <ace
                                :value="editorConfig.value"
                                :width="editorConfig.width"
                                :height="editorConfig.height"
                                :lang="editorConfig.lang"
                                :read-only="editorConfig.readOnly"
                                :full-screen="editorConfig.fullScreen"
                                @change-annotation="changeAnnotation(...arguments)"
                                @input="editorChangeHandler"
                                @init="editorInitAfter">
                                <!-- @change-annotation="changeAnnotation(index, ...arguments)" -->
                            </ace>
                        </div>
                    </template>
                </div>
            </div>
        </template>
        <div slot="footer">
            <div class="bk-dialog-outer">
                <template v-if="isUpdating">
                    <bk-button type="primary" :loading="isUpdating">
                        {{$t('generic.status.updating')}}
                    </bk-button>
                    <bk-button type="button" disabled>
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
                <template v-else>
                    <bk-button type="primary"
                        @click="rollingUpdateInNotPlatformConfirm">
                        {{$t('generic.button.confirm')}}
                    </bk-button>
                    <bk-button type="button" @click="hideRollingUpdateInNotPlatform">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
            </div>
        </div>
    </bk-dialog>

    <bk-dialog
        :is-show.sync="instanceNumDialogConf.isShow"
        :width="instanceNumDialogConf.width"
        :title="instanceNumDialogConf.title"
        :close-icon="!isUpdating"
        :ext-cls="'scale-dialog'"
        :quick-close="false"
        @cancel="hideInstanceNum">
        <template slot="content">
            <div class="scale-wrapper">
                <div class="bk-form-item">
                    <label class="bk-label">
                        {{$t('dashboard.workload.label.scaleNum')}}
                    </label>
                    <div class="bk-form-content" style="display: inline-block; margin-left: 10px;">
                        <bk-input
                            type="number"
                            v-model="instanceNum"
                            :min="0"
                            :max="5000"
                            :style="{ 'width': '260px' }"
                            :placeholder="$t('generic.placeholder.input')">
                        </bk-input>
                    </div>
                </div>
            </div>
        </template>
        <div slot="footer">
            <div class="bk-dialog-outer">
                <template v-if="isUpdating">
                    <bk-button type="primary" disabled>
                        {{$t('generic.status.updating')}}
                    </bk-button>
                    <bk-button type="button" class="bk-dialog-btn bk-dialog-btn-cancel disabled">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
                <template v-else>
                    <bk-button type="primary" class="bk-dialog-btn bk-dialog-btn-confirm bk-btn-primary"
                        @click="instanceNumConfirm">
                        {{$t('generic.button.confirm')}}
                    </bk-button>
                    <bk-button type="button" @click="hideInstanceNum">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
            </div>
        </div>
    </bk-dialog>

    <bk-dialog
        :position="{ top: 100 }"
        :is-show.sync="reBuildDialogConf.isShow"
        :width="reBuildDialogConf.width"
        :title="reBuildDialogConf.title"
        :close-icon="reBuildDialogConf.closeIcon"
        :ext-cls="'adjust-instance-dialog'"
        :quick-close="false">
        <template slot="content">
            <div class="rebuild-tip mb5">{{$t('deploy.templateset.recreateAssociatedPods')}}</div>
            <div v-bkloading="{isLoading: reBuildDialogConf.loading, opacity: 1}" style="height: 455px;">
                <ace v-show="!reBuildDialogConf.loading"
                    :value="reBuildDialogConf.aceValue"
                    :width="reBuildDialogConf.aceWidth"
                    :height="reBuildDialogConf.aceHeight"
                    :lang="reBuildDialogConf.aceLang"
                    :read-only="reBuildDialogConf.aceReadOnly"
                    :full-screen="reBuildDialogConf.aceFullScreen"
                    @init="editorInitInReBuild">
                </ace>
            </div>
        </template>
        <div slot="footer">
            <div class="bk-dialog-outer">
                <template v-if="isUpdating">
                    <bk-button type="primary" disabled>
                        {{$t('deploy.templateset.recreating')}}
                    </bk-button>
                    <bk-button type="button" class="bk-dialog-btn bk-dialog-btn-cancel disabled">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
                <template v-else>
                    <bk-button type="primary" class="bk-dialog-btn bk-dialog-btn-confirm bk-btn-primary"
                        @click="reBuildConfirm">
                        {{$t('generic.button.confirm')}}
                    </bk-button>
                    <bk-button type="button" @click="hideReBuild">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
            </div>
        </div>
    </bk-dialog>

    <bk-dialog
        :is-show.sync="deleteDialogConf.isShow"
        :width="deleteDialogConf.width"
        :title="deleteDialogConf.title"
        :close-icon="deleteDialogConf.closeIcon"
        :ext-cls="'adjust-instance-dialog biz-enable-dialog'"
        :quick-close="false">
        <template slot="content">
            <div>{{deleteDialogConf.content}}</div>
        </template>
        <div slot="footer">
            <div class="bk-dialog-outer">
                <template v-if="isUpdating">
                    <bk-button type="primary" disabled>
                        {{$t('generic.status.deleting')}}
                    </bk-button>
                    <bk-button type="button" class="bk-dialog-btn bk-dialog-btn-cancel disabled">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
                <template v-else>
                    <bk-button type="primary" class="bk-dialog-btn bk-dialog-btn-confirm bk-btn-primary"
                        @click="deleteConfirm">
                        {{$t('generic.button.confirm')}}
                    </bk-button>
                    <bk-button type="button" @click="hideDelete">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
            </div>
        </div>
    </bk-dialog>

    <bk-dialog
        :is-show.sync="forceDeleteDialogConf.isShow"
        :width="forceDeleteDialogConf.width"
        :title="forceDeleteDialogConf.title"
        :close-icon="forceDeleteDialogConf.closeIcon"
        :ext-cls="'adjust-instance-dialog biz-enable-dialog'"
        :quick-close="false">
        <template slot="content">
            <div>{{forceDeleteDialogConf.content}}</div>
        </template>
        <div slot="footer">
            <div class="bk-dialog-outer">
                <template v-if="isUpdating">
                    <bk-button type="primary" disabled>
                        {{$t('generic.status.deleting')}}
                    </bk-button>
                    <bk-button type="button" class="bk-dialog-btn bk-dialog-btn-cancel disabled">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
                <template v-else>
                    <bk-button type="primary" class="bk-dialog-btn bk-dialog-btn-confirm bk-btn-primary"
                        @click="forceDeleteConfirm">
                        {{$t('generic.button.confirm')}}
                    </bk-button>
                    <bk-button type="button" @click="hideForceDelete">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
            </div>
        </div>
    </bk-dialog>

    <bk-dialog
        :position="{ top: 100 }"
        :is-show.sync="rollbackPreviousDialogConf.isShow"
        :width="rollbackPreviousDialogConf.width"
        :title="rollbackPreviousDialogConf.title"
        :close-icon="rollbackPreviousDialogConf.closeIcon"
        :ext-cls="'biz-rollback-previous-dialog'"
        :quick-close="false"
        @confirm="rollbackPreviousConfirm"
        @cancel="hideRollbackPrevious">
        <template slot="content">
            <div v-bkloading="{isLoading: rollbackPreviousDialogConf.loading, opacity: 1}" style="min-height: 455px;">
                <div class="title-wrapper">
                    <div class="left">
                        <span style="margin-right: 40px;">{{$t('deploy.templateset.currentVersionConfig')}}</span>
                    </div>
                    <div class="right">{{$t('deploy.templateset.previousVersionConfig')}}</div>
                </div>
                <div class="diff-wrapper">
                    <monaco-editor
                        ref="yamlEditor"
                        class="editor"
                        theme="monokai"
                        language="yaml"
                        style="height: 400px; width: 100%"
                        v-model="rollbackPreviousDialogConf.curContent"
                        :diff-editor="useEditorDiff"
                        :options="yamlEditorOptions"
                        :key="reRenderEditor"
                        :original="rollbackPreviousDialogConf.prevContent"
                        @mounted="handleEditorMount">
                    </monaco-editor>
                </div>
            </div>
        </template>
        <div slot="footer">
            <div class="bk-dialog-outer">
                <template v-if="isUpdating">
                    <bk-button type="primary" disabled>
                        {{$t('deploy.templateset.rollbacking')}}
                    </bk-button>
                    <bk-button type="button" class="bk-dialog-btn bk-dialog-btn-cancel disabled">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
                <template v-else>
                    <bk-button type="primary" class="bk-dialog-btn bk-dialog-btn-confirm bk-btn-primary"
                        @click="rollbackPreviousConfirm">
                        {{$t('generic.button.confirm')}}
                    </bk-button>
                    <bk-button type="button" @click="hideRollbackPrevious">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
            </div>
        </div>
    </bk-dialog>

    <bk-dialog
        :title="$t('deploy.templateset.confirmRebuild')"
        :is-show="batchRebuildDialogConf.isShow"
        :width="420"
        :has-header="false"
        :has-footer="false"
        :ext-cls="'adjust-instance-dialog'"
        :quick-close="false"
        @cancel="hideBatchReBuild">
        <template slot="content">
            <div class="biz-batch-wrapper pb20">
                <p class="batch-title">
                    {{$t('deploy.templateset.confirmRebuildResources')}}
                    <span class="title-tip">{{$t('deploy.templateset.formatNamespaceAppName')}}</span>
                </p>
                <ul class="batch-list">
                    <li v-for="(item, index) of batchRebuildDialogConf.list" :key="index">{{item.namespace}}: {{item.name}}</li>
                </ul>
            </div>
        </template>
        <template slot="footer">
            <div class="bk-dialog-outer pt10 pb10">
                <template v-if="isUpdating">
                    <bk-button type="primary" disabled>
                        {{$t('deploy.templateset.recreating')}}
                    </bk-button>
                    <bk-button type="button" class="bk-dialog-btn bk-dialog-btn-cancel disabled">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
                <template v-else>
                    <bk-button type="primary" class="bk-dialog-btn bk-dialog-btn-confirm bk-btn-primary"
                        @click="batchRebuildConfirm">
                        {{$t('generic.button.confirm')}}
                    </bk-button>
                    <bk-button type="button" @click="hideBatchReBuild">
                        {{$t('generic.button.cancel')}}
                    </bk-button>
                </template>
            </div>
        </template>
    </bk-dialog>

    <div :title="$t('deploy.templateset.quit')" @click="cancelFullScreen" class="biz-configuration-instantiation-cancel-fullscreen"
        v-if="editorConfig.fullScreen || compareEditorConfig.fullScreen">
        <i class="bcs-icon bcs-icon-close"></i>
    </div>
</div>
