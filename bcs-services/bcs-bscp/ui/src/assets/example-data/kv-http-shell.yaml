#!/bin/bash

# 设置参数
feed_addr="{{ .Bk_Bscp_Variable_FEED_ADDR }}"
biz_id={{ .Bk_Bscp_Variable_BkBizId }}
service_name="{{ .Bk_Bscp_Variable_ServiceName }}"
key_name={{ .Bk_Bscp_Variable_KeyName }}
token={{ .Bk_Bscp_Variable_ClientKey }}
{{ .Bk_Bscp_Variable_Start_Leabels }}{{ .Bk_Bscp_Variable_Leabels }}

# 使用参数构建URL
url="http://{{ .Bk_Bscp_Variable_FEED_ADDR }}/api/v1/feed/biz/${biz_id}/kvs/data/${key_name}"

# 设置请求头，包括Authorization token
auth_header="Authorization: Bearer ${token}"

# 设置请求数据
data="{\"app_meta\": {\"app\": \"${service_name}\", \"labels\": ${labels}}}"

# 发送POST请求并保存响应
response=$(curl -s -X POST -H "${auth_header}" -d "${data}" "${url}")

# 打印响应内容
echo "Response content: ${response}"